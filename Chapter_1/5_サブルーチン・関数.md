## サブルーチン・関数

### 概要
プログラミングをするときに覚えておきたいサブルーチンの考え方と、Pythonでの実現方法についてざっくりと解説する。

### 分割分割。
ここまでプログラミングをお教えした際には、全てひとつらなりのソースコードとしてお伝えしました。  
しかし料理もそうですが、いくつかの大きな工程に分けた方が効率がいいこともあります。例えば、ソースを作る工程と鶏肉に火を通す工程です。  
今回お話するテクニックを使うと、そんなひとつらなりのソースコードを分割したり、似たような処理をまとめて書けるようになり、作業効率の向上につながるかもしれません。

ちなみに、この分割したものを「サブルーチン」もしくは「関数」や「メソッド」と言います。早速使い方を見て行きましょう。

### 関数の使い方
```py
def 関数名:
    関数で行う処理の内容

関数名()
```
上記が関数の定義と使用する時の記述です。実際の使用例を見てみましょう。

```py
def hello:
    print("Hello, method!")

hello()
#=> Hello, method!
```
また、関数の中には変数や条件分岐や反復処理を書くことも可能です。

```py
def hello:
    hour=12  # 動作が確認できたら、ここの値を変えてみましょう ;)
    if 12 <= hour:
        print("Good afternoon!")
    elif 0 <= hour:
        print("Good morning!")
    elif 24 <= hour:
        print("Oh! you have", hour, "times in day!")

hello()
#=>Good morning!
```

また、関数内部とは別に変数を外から取り入れて使いたい場合には以下のように記述します。
```py
def 関数名(関数の外から取り入れる変数):
    関数で行う処理の内容

関数名(使いたい値)
```

例えばこんな風に使います

```py
def hello(name):
    print("Hello,", name)

hello("Apple pie")
#=> Hello Apple pie
```

また、関数の外から取り入れる変数は複数使うこともできます。もちろんこの記述でも変数や条件分岐や反復処理を書くことは可能ですので、以下のようなこともできます。
```py
def powpow(a, b):
    pow = a
    for i in range(0, b + 1):
        a = a * pow
    answer = a
    print("answer")

powpow(3, 3)
#=>27
```

ちなみに、この関数を外から取り入れる変数のことを*引数*と言います。

しかし関数はソースコードを分割するだけではなく、機能を分割することもできます。というよりは、「素材を入れると加工してくれる」ものを作ることができます。  
つまりどういうことかと言いますと、以下のように「ある変数を与えると、それを元に計算した値を返す」という関数が作れます。  
例を見てみましょう。

```py
def calcRectArea(radius):
    '''
    半径から円の面積を求める関数。
    '''
    answer = radius ** 2 * 3.14
    return answer

print(calcRectArea(14)) # calcRectAreaのカッコの中を書き換えてみましょう ;)
#=>615.44
```

シンプルですね。半径を入力されたら円の面積を答える関数です。  
*return*というキーワードの後に書いた変数などを呼び出し元に返し、そこで処理から抜け出します。

### 内は内、外は外
ところで、この*関数*に限らずwhileやforやifの中で作られた変数は、それらの構文から抜けると捨てられてしまいます。  
お気づきになりましたか？

実際に例をみてみましょう。

```py
a = "module inner"
def function():
    b = "function inner"
    if True:
        c = "if inner"

print(a) # ここの値、bやcに変えてみましょう。
```

変数の定義場所と代入場所にも注目しましょう。  
次のソースコードも実行してみてください。

```py
a = "module inner"
def function:
    a = "function inner"
    if True:
        a = "if inner"

    print('関数内のa', a) # 関数内のa
print('モジュール内のa', a) # モジュール内のa
```

他にも実験して確かめたほうが理解は進むのですが、変数の宣言場所によっては呼び出せない事があることを覚えておいてください。  
特に、関数の中で使った変数は関数内でしか呼び出せません。

では関数内の変数を関数の外や別の関数に出したいときはどうするべきか、ちょっと前を読み返せばすぐわかるはずです。

### まとめ
今回は以下のことを覚えていてください。

* サブルーチンや関数やメソッドを使うことによって、大きなプログラムも分割して書ける
* Pythonではdefで関数・メソッドを定義することができる
* 関数やメソッド内で定義された変数はそれらの中でしか使えない

### 余談
#### 関数とメソッドの違い
今回のテキストの中では「関数」と統一しましたが、関数とメソッドの違いについて簡単に説明いたします。  
Pythonではもう２つ、ソースコードの集まりの単位（というのは正確ではありませんが）として*モジュール*と*クラス*というものがあります。今回注目するのは*クラス*です。

クラスは次回詳しくお伝えしますが、クラスの中に入っている関数がメソッドとなり、クラスの外で作られた関数はそのまま関数と呼ばれま。

/* ご指摘くださった SamuraiT さん、ありがとうございます。 */

#### モジュール
Pythonではもう２つ、ソースコードの集まりの単位（というのは正確ではありませんが）として*モジュール*と*クラス*というものがあります。  
ここではその一つであるモジュールについてお話します。

たくさんのソースコードを記述すると、その行数はごく普通に1000行を簡単に超えてしまいます。それを一つのファイルにまとめてしまうのは見通し上好ましくありません。（本の百科事典が「あ」から「ん」まで1冊にまとまっていたら、持てませんし読みづらいかと思います。それと同じ感覚です。）

Pythonにおけるモジュールはファイルです。

試しに次の2つのソースコードを別々に保存しましょう。

```py
'''
Listener
'''
print('四角形の面積 : 1')
print('三角形の面積 : 2')
print('それ以外の数字を入力すると終了します')
call_function = int(input('動かしたい機能を入力してください >>> '))

if 1 == call_function:
    width = float(input('横の長さを入力してください >>> '))
    height = float(input('高さを入力してください >>> '))
    print('四角形の面積は', calcRectArea(width, height), 'になります')
elif 2 == call_function:
    width = float(input('横の長さを入力してください >>> '))
    height = float(input('高さを入力してください >>> ')
    print('三角形の面積は', calcTriangleArea(width, height), 'になります')
else
    print('終了します')
```

```py
'''
Functions
'''
def calcRectArea(x = 1, y = 1):    # 引数に代入を指定すると、何も入力しなかった時の値を指定することができます。
    '''
    四角形の面積計算
    '''
    answer = x * y
    return answer

def calcTriangleArea(x = 1, y = 1):
    '''
    三角形の面積計算
    '''
    answer = x * y / 2
    return = answer
```

さて、実はこのソースコードを動かしても動きません。イジワルシマシタ :P  

"Function"の方のpyファイルを"Functions"というフォルダを作って、そのフォルダの中に入れます。  
次に"Functions"フォルダに"\_\_init\_\_.py"というファイルを作ってください。（ファイルの中には何も書かなくて大丈夫です）  
そして最後に"Listener"を次のように書き直します。

```py
'''
Listener
'''

from Functions.Function import Functions    # ここ追加

print('四角形の面積 : 1')
print('三角形の面積 : 2')
print('それ以外の数字を入力すると終了します')
call_function = int(input('動かしたい機能を入力してください >>> '))

if 1 == call_function:
    width = float(input('横の長さを入力してください >>> '))
    height = float(input('高さを入力してください >>> '))
    print('四角形の面積は', Function.calcRectArea(width, height), 'になります')    # ここ変更
elif 2 == call_function:
    width = float(input('横の長さを入力してください >>> '))
    height = float(input('高さを入力してください >>> ')
    print('三角形の面積は', Function.calcTriangleArea(width, height), 'になります')    # ここ変更
else
    print('終了します')
```

では、これで"Listener"を実行してみましょう。

このように、モジュールという形でソースコードを分割し、部品として切り分けることができるようになります。

そこで何が便利なのか、このように部品ごとに分割することによって、その部品だけを別のプログラムに使いまわしたりすることが容易になったりします。

### 参考資料
* [初めてのPython(5) importとfromとreloadでモジュールを使いこなす](http://1-byte.jp/2010/09/29/learning_python5/)
