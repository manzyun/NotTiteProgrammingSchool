## コンピューターの中の数値
数値を扱う上での便利な命令を教えようと思ったのですが、その前にコンピューターの中での数値について今一度復習しましょう。  
（ところで、「数値」という言葉を使っていますが、文字列データの「数字」の並びと区別するために書いております。）

コンピューターは全てのものごとを2進数で解釈し、演算するというのは[コンピューターとプログラム](コンピューターとプログラム.md)で触れたかと思いますが、このことを忘れて精密な計算をすると、あなたが思っていたような計算結果がでないことが出てきます。

### 2種類の数字
コンピューターの中では大きく分けると3つの種類の数値が存在します。  
「数値に種類とはどういうことだ。訳がわからん」  
とお嘆きの方、ちょっとお待ちを。日常でも何種類かあるじゃないですか。整数、分数、小数、百分率、平方根、虚数、複素数、etc...  
コンピューターの中では整数（小数点の無い数値）と小数（小数点のある数字）が基本の数値の種類となります。（その他の数字が表現できない訳ではないのですが、ちょっと脇に置いておいて）  
そして、コンピューターの中では*整数*と小数が明確に分けられまして、小数の表現もいくつかあるのですが、今回は*浮動小数点数*について解説します。

### 浮動小数点数
小数の数値は細かく見ようと思えば何百桁にもなってしまいまして、それを素直に表現しようとすると莫大なデータ量になってしまいまして非効率なところがあります（みなさんだって、すっごく小さな値を表すときにたくさん0を書きたくないと思います）し、そもそもコンピューターで扱える桁数は有限です（一見無限に見えても）。  
そこで、できるだけ少ない桁数（コンピューターの中だと「スイッチ」）でできるだけ小さい数字を表現しようとした際に生まれたのがこの浮動小数点数という表現方法です。

基本的な考え方は「指数表記」というもので、「3×10^8（^は累乗）」と言った具合で大きな数や小さな数を表見する方法です。  
ちょっとIDLEを起動してPython Shellに次のソースコードを打ち込んで、さっきの式を計算させてみましょう。

```
3 * 10 ** 8
```

おそらく「300000000」という数字がでたかと思います。3億ですね。  
ところで唐突に「**」という記号を出しましたが、これは累乗を表します。

ここでちょっとPythonで使える計算機号についてまとめておきましょう。

|書き方|意味|
|---|---|
|x + y|x と yを足す。（加算）|
|x - y|x から yを引く。（減算）|
|x * y|x と yをかける。（乗算）｜
|x / y|x から yを割る。（除算）|
|x // y|x から yを割って、小数点以下の数字を切り捨てる（整数の値になるように除算）|
|x ** y|x を y回かける（累乗）「3 ** 3」だと「3 * 3 * 3」となる。|
|-x|0より小さい数値x（負の数）|

もちろん計算される順番は「累乗→乗算・除算→加算・減算」という順番です。

それでは次は下のソースコードを打ち込んで計算させてみましょう。

```
3* 10 ** -3
```

おそらく「0.003」という答えが返ってきたと思います。  
というところで「指数表記」について何となくお分かりいただけましたでしょうか？

浮動小数点数も指数表記を元に考えておりいくつか種類があるのですが、2014年現在一番普及しているIEEE754方式で説明していきます。

どれだけ細かい数値を表現するかによって予め必要な桁数をコンピューターに命令したりしますが、今回は16桁の2進数を浮動小数点数の表現に割り当てたと想定しましょう。  
その際の各桁の割り当ては次のようになります。

|符号部|指数部|仮数部|
|---|---|---|
|1桁|5桁|10桁|

あー待ってください待ってください！ ペンを投げないで、そんな悲しい顔をしないで！  
難しい言葉が出てきましたけど、1つずつ見ていきましょう。

**符号部**：この部分では0より大きい数字なのか小さい数字なのかを表します。この桁が0の時が0より大きい数、1の時は0より小さい数となります。

**指数部**：この部分はどれだけ小さい数であるのかを示す値となります。先ほどの指数表記の累乗の数となります。

**仮数部**：この部分が指数をかける前の数値となります。先ほどの指数表記の式の一番最初の数です。

ちなみに、この際の指数を累乗される値は2進数の数字となるため「2」となります。

### コンピューターの誤差

さて、冒頭で「あなたが思っていたような計算結果がでないことが出てきます。」と書きましたが。コンピューター（というより2014年現在の計算機全般に言えることですが）は一度に計算できる桁数が限られているため、端数処理による*丸め誤差*や、絶対値（簡単に言うと符号を無視した数字）の幅が極端に広い数値を加減算すると、絶対値の小さい数字が無視されてします*情報落ち*などの現象が起こります。

これらのことを*誤差*と言いますが、特に浮動小数点数で発生しますので、信頼性が求められる数値を扱う際（お金の管理など）には*固定小数点数*という表現を使って計算したほうがよいでしょう。  
逆に、天文学的な数字や誤差がでても支障のでない科学や統計計算であれば、誤差が発生することを踏まえつつも、桁数の多く使える浮動小数点数を使って計算したほうがよいでしょう。

### Pythonでの数値表現
ではPythonで*整数*や*浮動小数点数*、*固定小数点数*を扱う際の命令を見て行きましょう。

と言っても、Pythonは整数同士の計算結果を変数に代入するとその変数は自動的に整数型という「整数を入れるデータの型」になって、計算結果を補完します。  
また、小数点同士の計算結果を変数に代入した場合には、変数は浮動小数点型になって補完します。  
ちなみに整数と小数点の計算をした場合には浮動小数点型となります。

では固定小数点型を使いたい場合は？　まず以下のソースコードを加えます。

```py
from decimal import *
```

そして必要であればコンテキスト（簡単に言うと数値の書式設定）を以下のソースコードを参考に設定してください。

```py
# 演算時の精度（小数点以下の桁数）の指定
getcontext().prec = 7

# 精度からはみ出た桁の丸め方
# ROUND_CEILING : 正の数の方向に丸める。
# ROUND_DOWN : ゼロ方向に丸める。
# ROUND_FLOOR : 負の数の方向に丸める。
# ROUND_HALF_DOWN : 近い値に丸める。引き分けの場合はゼロ方向に丸める。
# ROUND_HALF_EVEN : 近い値に丸める。引き分けの場合は偶数整数方向に丸める。
# ROUND_HALF_UP : 近い値に丸める。引き分けの場合は0から遠い方向に丸める。
# ROUND_UP : ゼロから遠い方向に丸める。
# ROUND_05UP : ゼロ方向に丸めた後の最後の桁が 0 または 5 ならばゼロから遠い方向に、そうでなければゼロ方向に丸める。

getcontext().rounding = ROUND_CEILING
```

そして以下のように指定します。

```py
number = Decimal('10.5')
```

更に詳しいDecimalの使い方は[9.4. decimal — 10進固定及び浮動小数点数の算術演算 — Python 3.3.3 ドキュメント](http://docs.python.jp/3.3/library/decimal.html?highlight=decimal#decimal)を参照してください。


## 数値型での便利な命令
それでは数値を扱う際の便利な命令を見て行きましょう。

### int(), float(), round()
int()は前回の演習問題でも使いましたね。しかしint()命令は整数への変換しか対応していません。次のソースコードを実行してみましょう。

```py
print(int(3.14))
```

どうでしょう？ 「3」と表示されたかと思います。int()で囲まれた数値は小数点を切り落としてしまいます。
ちなみにintの中に小数点を含んだ数字を入力すると、intはエラーを出してしまいます。

それではinputした小数点を含んだ数字を実数にしたい場合はどうすればいいでしょう。次のようにしてみます。

```py
x = float(input('小数点を含んだ値を入力'))
print(x)
```

これで小数を含む数字を入力してもちゃんと表示されたかと思います。

小数を含んだ数値も使えるようになると、次は四捨五入をしたくなると思います。そこで使うのがround()命令です。  
次のように使います

```py
round(3.142537, 2)
# 最初に四捨五入したい数値を入れる（変数も可）
# 「,」で区切った後ろに小数点以下の桁数を入れる（省略可。省略した場合には整数まで四捨五入）
```

ここでちょっと予習。  
実は今まで「命令」と伝えていたint()やfloat()は、「関数」もしくは「メソッド」と言います。  
詳しいお話はもう少し先にいたしましょう。

### 数学関数

高度な計算をさせたい場合はまず次のソースコードを入れます。

```py
import math
```

お察しのよい方は既にお分かりかもしれませんが、この命令を入れることによって「数学でよく使うような命令」が扱えるようになります。  
例えば次のようなものがあります。

```py
x = 2
y = 3

# 任意の数値xの任意の数値yを計算します。x ** yと同じ
math.pow(x, y)

# 平方根を計算します。
math.sqrt(x)

# 円周率を提供します。
math.pi

# 角度をラジアンに変換します。
math.radians(45)

# ラジアンを角度に変換します。
math.degrees(2 * math.pi)

radius = 0.25 * math.pi
# ラジアンから正弦・余弦・正接の値を計算します。
math.sin(radius) #正弦
math.cos(radius) #余弦
math.tan(radius) #正接
```

更に数学関数の事を知りたい場合は[9.2. math — 数学関数 — Python 3.3.3 ドキュメント](http://docs.python.jp/3.3/library/math.html#module-math)をご覧ください。

## まとめ
とりあえず以下の事を本日は覚えておいてください。
* コンピューターの数値には「整数」と「浮動小数点数」という2つの数値がある。
* コンピューターは2進数で計算したり、一度に計算できる桁数が限られているため、10進数に直した時にズレが生じる。


## 演習問題
今回は数学の話がいっぱい出てきてクタクタになったかもしれませんので、今回の問題は余力のある方で結構ですのでやってみてください。  
とある建物があるとします。  
その建物から自分の居る所までの距離と、建物の頂上を見上げた時の角度を入力すると、建物の高さを計算してくれるプログラムを作ってみましょう。

### ヒント
高校数学の問題なのでちょっとむずかしいです。三角関数を使って解くことを想定していますが、もしかしたら使わなくても解けるかな？  
具体的には「底辺 × tanθ」という式で解けます。
